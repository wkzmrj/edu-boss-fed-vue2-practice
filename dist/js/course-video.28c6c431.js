"use strict";(self["webpackChunkedu_boss_fed_vue2"]=self["webpackChunkedu_boss_fed_vue2"]||[]).push([[190],{7256:function(e,s,a){a.r(s),a.d(s,{default:function(){return h}});a(7658);var o=function(){var e=this,s=e._self._c;return s("div",{staticClass:"course-video"},[s("el-card",[s("div",{attrs:{slot:"header"},slot:"header"},[e._v(" 课程相关信息 ")]),s("el-form",[s("el-form-item",{attrs:{label:"视频上传"}},[s("input",{ref:"video-file",attrs:{type:"file"}})]),s("el-form-item",{attrs:{label:"封面上传"}},[s("input",{ref:"image-file",attrs:{type:"file"}})]),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.handleUpload}},[e._v("开始上传")]),s("el-button",{on:{click:function(s){return e.$router.push({name:"course-section",params:{courseId:e.courseId}})}}},[e._v("返回")])],1),s("el-form-item",[0!==e.uploadPercent?s("p",[e._v("视频上传中: "+e._s(e.uploadPercent)+"%")]):e._e(),e.isUploadSuccess?s("p",[e._v("视频转码中："+e._s(e.isTranscodeSuccess?"完成":"正在转码中..."))]):e._e()])],1)],1)],1)},t=[],d=a(3139);const i=()=>(0,d.Z)({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"}),l=e=>(0,d.Z)({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e}),r=e=>(0,d.Z)({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:e}),n=e=>(0,d.Z)({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}});var u={name:"CourseVideo",props:{courseId:{type:[String,Number],required:!0}},data(){return{imageURL:"",uploader:null,videoId:null,uploadPercent:0,isUploadSuccess:!1,isTranscodeSuccess:!1}},created(){this.initUploader()},methods:{handleUpload(){this.uploadPercent=0,this.isUploadSuccess=!1,this.isTranscodeSuccess=!1;const e=this.$refs["video-file"].files[0],s=this.$refs["image-file"].files[0],a=this.uploader;a.addFile(s),a.addFile(e),a.startUpload()},initUploader(){this.uploader=new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:async e=>{let s=null;if(e.isImage){const{data:e}=await i();"000000"===e.code&&(s=e.data,this.imageURL=s.imageURL)}else{const{data:a}=await l({fileName:e.file.name,imageUrl:this.imageURL});"000000"===a.code&&(s=a.data,this.videoId=a.data.videoId)}this.uploader.setUploadAuthAndAddress(e,s.uploadAuth,s.uploadAddress,s.imageId||s.videoId)},onUploadSucceed:function(e){},onUploadFailed:function(e,s,a){},onUploadProgress:(e,s,a)=>{e.isImage||(this.uploadPercent=Math.floor(100*a))},onUploadTokenExpired:function(e){},onUploadEnd:async e=>{this.isUploadSuccess=!0;const s=this.$route.query.lessonId,{data:a}=await r({lessonId:s,coverImageUrl:this.imageURL,fileId:this.videoId,fileName:this.$refs["video-file"].files[0].name});if("000000"===a.code){const e=setInterval((async()=>{const{data:a}=await n(s);"000000"===a.code&&100===a.data&&(this.isTranscodeSuccess=!0,this.$message.success("视频转码成功"),clearInterval(e))}),1e3)}}})}}},c=u,p=a(1001),f=(0,p.Z)(c,o,t,!1,null,"5aa2220d",null),h=f.exports}}]);
//# sourceMappingURL=course-video.28c6c431.js.map