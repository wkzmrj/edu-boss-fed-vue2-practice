{"version":3,"file":"js/course-section.0d526412.js","mappings":"0LAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,kBAAkB,CAACF,EAAG,UAAU,CAACA,EAAG,UAAU,CAACG,WAAW,CAAC,CAACC,KAAK,UAAUC,QAAQ,YAAYC,MAAOR,EAAIS,UAAWC,WAAW,cAAcC,MAAM,CAAC,KAAOX,EAAIY,SAAS,MAAQZ,EAAIa,aAAa,UAAY,GAAG,aAAab,EAAIc,iBAAiBC,GAAG,CAAC,YAAYf,EAAIgB,gBAAgBC,YAAYjB,EAAIkB,GAAG,CAAC,CAACC,IAAI,UAAUC,GAAG,UAAS,KAAEC,EAAF,KAAQC,IAAQ,OAAOpB,EAAG,MAAM,CAACE,YAAY,SAAS,CAACF,EAAG,OAAO,CAACF,EAAIuB,GAAGvB,EAAIwB,GAAGH,EAAKI,UAAWH,EAAKI,YAAaxB,EAAG,OAAO,CAACE,YAAY,WAAW,CAACF,EAAG,YAAY,CAACF,EAAIuB,GAAG,QAAQrB,EAAG,YAAY,CAACF,EAAIuB,GAAG,UAAUrB,EAAG,YAAY,CAACF,EAAIuB,GAAG,SAAS,GAAGrB,EAAG,OAAO,CAACE,YAAY,WAAW,CAACF,EAAG,YAAY,CAACF,EAAIuB,GAAG,QAAQrB,EAAG,YAAY,CAACa,GAAG,CAAC,MAAQ,SAASY,GAAQ,OAAO3B,EAAI4B,QAAQC,KAAK,CAChxBvB,KAAM,eACNwB,OAAQ,CACNC,SAAU/B,EAAI+B,UAEhBC,MAAO,CACLC,SAAUX,EAAKY,KAEhB,IAAG,CAAClC,EAAIuB,GAAG,UAAUrB,EAAG,YAAY,CAACF,EAAIuB,GAAG,SAAS,IAAK,QAAO,IAAI,EACnF,EACGY,EAAkB,G,UCRf,MAAMC,EAAsBL,IAC1BM,EAAAA,EAAAA,GAAQ,CACbC,OAAQ,MACRC,IAAK,2CACLT,OAAQ,CACNC,cAMOS,EAAsBlB,IAC1Be,EAAAA,EAAAA,GAAQ,CACbC,OAAQ,OACRC,IAAK,2CACLjB,SAKSmB,EAAqBnB,IACzBe,EAAAA,EAAAA,GAAQ,CACbC,OAAQ,OACRC,IAAK,mCACLjB,SCkBJ,OACAhB,KAAAA,gBACAoC,MAAAA,CACAX,SAAAA,CACAY,KAAAA,CAAAA,OAAAA,QACAC,UAAAA,IAGAC,UACA,kBACA,EACAvB,OACA,OAEAV,SAAAA,GACAC,aAAAA,CACAiC,SAAAA,aACArB,MAAAA,GAEA,6BACA,GAEAhB,WAAAA,EAEA,EACAsC,QAAAA,CAEA,8BACA,kBACA,UAEA,4CAEA,iBAEA,GACAb,GAAAA,EAAAA,KAAAA,GACAc,SAAAA,IAIA,GACAd,GAAAA,EAAAA,KAAAA,GACAc,SAAAA,OAIA,+BAGA,CAFA,SACA,+BACA,CACA,iBACA,EAEAlC,gBAAAA,EAAAA,EAAAA,GAGA,sDACA,EACA,oBACA,WAAAQ,SAAA,iBACA,oBACA,qBAEA,IC5GgQ,I,UCQ5P2B,GAAY,OACd,EACAlD,EACAoC,GACA,EACA,KACA,WACA,MAIF,EAAec,EAAiB,O","sources":["webpack://edu-boss-fed-vue2/./src/views/course/section.vue","webpack://edu-boss-fed-vue2/./src/services/course-section.js","webpack://edu-boss-fed-vue2/src/views/course/section.vue","webpack://edu-boss-fed-vue2/./src/views/course/section.vue?eff6","webpack://edu-boss-fed-vue2/./src/views/course/section.vue?9c95"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"course-section\"},[_c('el-card',[_c('el-tree',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.isLoading),expression:\"isLoading\"}],attrs:{\"data\":_vm.sections,\"props\":_vm.defaultProps,\"draggable\":\"\",\"allow-drop\":_vm.handleAllowDrop},on:{\"node-drop\":_vm.handleNodeDrop},scopedSlots:_vm._u([{key:\"default\",fn:function({ node, data }){return _c('div',{staticClass:\"inner\"},[_c('span',[_vm._v(_vm._s(node.label))]),(data.sectionName)?_c('span',{staticClass:\"actions\"},[_c('el-button',[_vm._v(\"编辑\")]),_c('el-button',[_vm._v(\"添加课时\")]),_c('el-button',[_vm._v(\"状态\")])],1):_c('span',{staticClass:\"actions\"},[_c('el-button',[_vm._v(\"编辑\")]),_c('el-button',{on:{\"click\":function($event){return _vm.$router.push({\n              name: 'course-video',\n              params: {\n                courseId: _vm.courseId\n              },\n              query: {\n                lessonId: data.id\n              }\n            })}}},[_vm._v(\"上传视频\")]),_c('el-button',[_vm._v(\"状态\")])],1)])}}])})],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import request from '@/utils/request'\n\nexport const getSectionAndLesson = courseId => {\n  return request({\n    method: 'GET',\n    url: '/boss/course/section/getSectionAndLesson',\n    params: {\n      courseId\n    }\n  })\n}\n\n// 新增或更新章节\nexport const saveOrUpdateSection = data => {\n  return request({\n    method: 'POST',\n    url: '/boss/course/section/saveOrUpdateSection',\n    data\n  })\n}\n\n// 新增或更新课时\nexport const saveOrUpdateLesson = data => {\n  return request({\n    method: 'POST',\n    url: '/boss/course/lesson/saveOrUpdate',\n    data\n  })\n}\n","<template>\n  <div class=\"course-section\">\n    <el-card>\n      <el-tree\n        v-loading=\"isLoading\"\n        :data=\"sections\"\n        :props=\"defaultProps\"\n        draggable\n        :allow-drop=\"handleAllowDrop\"\n        @node-drop=\"handleNodeDrop\"\n      >\n        <div class=\"inner\" slot-scope=\"{ node, data }\">\n          <!-- 内容设置 -->\n          <span>{{ node.label }}</span>\n          <!-- 后续按钮结构 -->\n          <span v-if=\"data.sectionName\" class=\"actions\">\n            <el-button>编辑</el-button>\n            <el-button>添加课时</el-button>\n            <el-button>状态</el-button>\n          </span>\n          <span v-else class=\"actions\">\n            <el-button>编辑</el-button>\n            <el-button\n              @click=\"$router.push({\n                name: 'course-video',\n                params: {\n                  courseId\n                },\n                query: {\n                  lessonId: data.id\n                }\n              })\"\n            >上传视频</el-button>\n            <el-button>状态</el-button>\n          </span>\n        </div>\n      </el-tree>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { getSectionAndLesson, saveOrUpdateSection, saveOrUpdateLesson } from '@/services/course-section'\n\nexport default {\n  name: 'CourseSection',\n  props: {\n    courseId: {\n      type: [String, Number],\n      required: true\n    }\n  },\n  created () {\n    this.loadSection()\n  },\n  data () {\n    return {\n      // 章节信息\n      sections: [],\n      defaultProps: {\n        children: 'lessonDTOS',\n        label (data) {\n          // data 是章节或课时的时候，label 的属性名不同，需要检测后使用\n          return data.sectionName || data.theme\n        }\n      },\n      isLoading: false\n    }\n  },\n  methods: {\n    // 节点拖拽完毕后的处理函数\n    async handleNodeDrop (draggingNode, dropNode, type, event) {\n      this.isLoading = true\n      try {\n        // 由于有很多章节与课时，需要给每个章节与课时都进行最新的排序顺序的请求\n        await Promise.all(dropNode.parent.childNodes.map((item, index) => {\n          // 判断当前是章节还是课时，再给对应接口发送请求即可\n          if (draggingNode.data.sectionId) {\n            // 课时接口处理\n            return saveOrUpdateLesson({\n              id: item.data.id,\n              orderNum: index\n            })\n          } else {\n            // 章节接口处理\n            return saveOrUpdateSection({\n              id: item.data.id,\n              orderNum: index\n            })\n          }\n        }))\n        this.$message.success('数据更新成功')\n      } catch (err) {\n        this.$message.error('数据更新失败', err)\n      }\n      this.isLoading = false\n    },\n    // 节点拖拽处理函数\n    handleAllowDrop (draggingNode, dropNode, type) {\n      // - 规则1： 只能同级移动，type 不能为 'inner'\n      // - 规则2： 课时不能移动到其他章节中\n      return type !== 'inner' && draggingNode.data.sectionId === dropNode.data.sectionId\n    },\n    async loadSection () {\n      const { data } = await getSectionAndLesson(this.courseId)\n      if (data.code === '000000') {\n        this.sections = data.data\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.inner {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px;\n  border-bottom: 1px solid #ebeef5;\n}\n\n::v-deep .el-tree-node__content {\n  height: auto;\n}\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./section.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./section.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./section.vue?vue&type=template&id=15aa872a&scoped=true&\"\nimport script from \"./section.vue?vue&type=script&lang=js&\"\nexport * from \"./section.vue?vue&type=script&lang=js&\"\nimport style0 from \"./section.vue?vue&type=style&index=0&id=15aa872a&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"15aa872a\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","directives","name","rawName","value","isLoading","expression","attrs","sections","defaultProps","handleAllowDrop","on","handleNodeDrop","scopedSlots","_u","key","fn","node","data","_v","_s","label","sectionName","$event","$router","push","params","courseId","query","lessonId","id","staticRenderFns","getSectionAndLesson","request","method","url","saveOrUpdateSection","saveOrUpdateLesson","props","type","required","created","children","methods","orderNum","component"],"sourceRoot":""}